import{SignClient as I,SessionStore as M}from"@walletconnect/sign-client";import{Core as m}from"@walletconnect/core";var l={exports:{}},h=typeof Reflect=="object"?Reflect:null,y=h&&typeof h.apply=="function"?h.apply:function(t,e,s){return Function.prototype.apply.call(t,e,s)},f;h&&typeof h.ownKeys=="function"?f=h.ownKeys:Object.getOwnPropertySymbols?f=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:f=function(t){return Object.getOwnPropertyNames(t)};function K(n){console&&console.warn&&console.warn(n)}var w=Number.isNaN||function(t){return t!==t};function o(){o.init.call(this)}l.exports=o,l.exports.once=F,o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var L=10;function g(n){if(typeof n!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof n)}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return L},set:function(n){if(typeof n!="number"||n<0||w(n))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+n+".");L=n}}),o.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||w(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function S(n){return n._maxListeners===void 0?o.defaultMaxListeners:n._maxListeners}o.prototype.getMaxListeners=function(){return S(this)},o.prototype.emit=function(t){for(var e=[],s=1;s<arguments.length;s++)e.push(arguments[s]);var i=t==="error",a=this._events;if(a!==void 0)i=i&&a.error===void 0;else if(!i)return!1;if(i){var r;if(e.length>0&&(r=e[0]),r instanceof Error)throw r;var c=new Error("Unhandled error."+(r?" ("+r.message+")":""));throw c.context=r,c}var u=a[t];if(u===void 0)return!1;if(typeof u=="function")y(u,this,e);else for(var d=u.length,q=b(u,d),s=0;s<d;++s)y(q[s],this,e);return!0};function _(n,t,e,s){var i,a,r;if(g(e),a=n._events,a===void 0?(a=n._events=Object.create(null),n._eventsCount=0):(a.newListener!==void 0&&(n.emit("newListener",t,e.listener?e.listener:e),a=n._events),r=a[t]),r===void 0)r=a[t]=e,++n._eventsCount;else if(typeof r=="function"?r=a[t]=s?[e,r]:[r,e]:s?r.unshift(e):r.push(e),i=S(n),i>0&&r.length>i&&!r.warned){r.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+r.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=n,c.type=t,c.count=r.length,K(c)}return n}o.prototype.addListener=function(t,e){return _(this,t,e,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(t,e){return _(this,t,e,!0)};function k(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function C(n,t,e){var s={fired:!1,wrapFn:void 0,target:n,type:t,listener:e},i=k.bind(s);return i.listener=e,s.wrapFn=i,i}o.prototype.once=function(t,e){return g(e),this.on(t,C(this,t,e)),this},o.prototype.prependOnceListener=function(t,e){return g(e),this.prependListener(t,C(this,t,e)),this},o.prototype.removeListener=function(t,e){var s,i,a,r,c;if(g(e),i=this._events,i===void 0)return this;if(s=i[t],s===void 0)return this;if(s===e||s.listener===e)--this._eventsCount===0?this._events=Object.create(null):(delete i[t],i.removeListener&&this.emit("removeListener",t,s.listener||e));else if(typeof s!="function"){for(a=-1,r=s.length-1;r>=0;r--)if(s[r]===e||s[r].listener===e){c=s[r].listener,a=r;break}if(a<0)return this;a===0?s.shift():W(s,a),s.length===1&&(i[t]=s[0]),i.removeListener!==void 0&&this.emit("removeListener",t,c||e)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(t){var e,s,i;if(s=this._events,s===void 0)return this;if(s.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):s[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete s[t]),this;if(arguments.length===0){var a=Object.keys(s),r;for(i=0;i<a.length;++i)r=a[i],r!=="removeListener"&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(e=s[t],typeof e=="function")this.removeListener(t,e);else if(e!==void 0)for(i=e.length-1;i>=0;i--)this.removeListener(t,e[i]);return this};function E(n,t,e){var s=n._events;if(s===void 0)return[];var i=s[t];return i===void 0?[]:typeof i=="function"?e?[i.listener||i]:[i]:e?D(i):b(i,i.length)}o.prototype.listeners=function(t){return E(this,t,!0)},o.prototype.rawListeners=function(t){return E(this,t,!1)},o.listenerCount=function(n,t){return typeof n.listenerCount=="function"?n.listenerCount(t):O.call(n,t)},o.prototype.listenerCount=O;function O(n){var t=this._events;if(t!==void 0){var e=t[n];if(typeof e=="function")return 1;if(e!==void 0)return e.length}return 0}o.prototype.eventNames=function(){return this._eventsCount>0?f(this._events):[]};function b(n,t){for(var e=new Array(t),s=0;s<t;++s)e[s]=n[s];return e}function W(n,t){for(;t+1<n.length;t++)n[t]=n[t+1];n.pop()}function D(n){for(var t=new Array(n.length),e=0;e<t.length;++e)t[e]=n[e].listener||n[e];return t}function F(n,t){return new Promise(function(e,s){function i(r){n.removeListener(t,a),s(r)}function a(){typeof n.removeListener=="function"&&n.removeListener("error",i),e([].slice.call(arguments))}x(n,t,a,{once:!0}),t!=="error"&&z(n,i,{once:!0})})}function z(n,t,e){typeof n.on=="function"&&x(n,"error",t,e)}function x(n,t,e,s){if(typeof n.on=="function")s.once?n.once(t,e):n.on(t,e);else if(typeof n.addEventListener=="function")n.addEventListener(t,function i(a){s.once&&n.removeEventListener(t,i),e(a)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof n)}const P="wc",U=2,p="WalletKit",X=`${P}@2:${p}:`,$={database:":memory:"},G="request";class H extends l.exports{constructor(){super()}}class R{constructor(t){this.opts=t}}class A{constructor(t){this.client=t}}var Q=Object.defineProperty,V=Object.defineProperties,B=Object.getOwnPropertyDescriptors,j=Object.getOwnPropertySymbols,J=Object.prototype.hasOwnProperty,Y=Object.prototype.propertyIsEnumerable,T=(n,t,e)=>t in n?Q(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,Z=(n,t)=>{for(var e in t||(t={}))J.call(t,e)&&T(n,e,t[e]);if(j)for(var e of j(t))Y.call(t,e)&&T(n,e,t[e]);return n},ee=(n,t)=>V(n,B(t));class te extends A{constructor(t){super(t),this.init=async()=>{this.signClient=await I.init({core:this.client.core,metadata:this.client.metadata,signConfig:this.client.signConfig}),this.signClient.core.eventClient.init().catch(e=>{this.client.logger.warn(e)})},this.pair=async e=>{await this.client.core.pairing.pair(e)},this.approveSession=async e=>{const{topic:s,acknowledged:i}=await this.signClient.approve(ee(Z({},e),{id:e.id,namespaces:e.namespaces,sessionProperties:e.sessionProperties,sessionConfig:e.sessionConfig}));return await i(),this.signClient.session.get(s)},this.rejectSession=async e=>await this.signClient.reject(e),this.updateSession=async e=>await this.signClient.update(e),this.extendSession=async e=>await this.signClient.extend(e),this.respondSessionRequest=async e=>await this.signClient.respond(e),this.disconnectSession=async e=>await this.signClient.disconnect(e),this.emitSessionEvent=async e=>await this.signClient.emit(e),this.getActiveSessions=()=>this.signClient.session.getAll().reduce((e,s)=>(e[s.topic]=s,e),{}),this.getPendingSessionProposals=()=>this.signClient.proposal.getAll(),this.getPendingSessionRequests=()=>this.signClient.getPendingSessionRequests(),this.approveSessionAuthenticate=async e=>await this.signClient.approveSessionAuthenticate(e),this.rejectSessionAuthenticate=async e=>await this.signClient.rejectSessionAuthenticate(e),this.formatAuthMessage=e=>this.signClient.formatAuthMessage(e),this.registerDeviceToken=e=>this.client.core.echoClient.registerDeviceToken(e),this.on=(e,s)=>(this.setEvent(e,"off"),this.setEvent(e,"on"),this.client.events.on(e,s)),this.once=(e,s)=>(this.setEvent(e,"off"),this.setEvent(e,"once"),this.client.events.once(e,s)),this.off=(e,s)=>(this.setEvent(e,"off"),this.client.events.off(e,s)),this.removeListener=(e,s)=>(this.setEvent(e,"removeListener"),this.client.events.removeListener(e,s)),this.onSessionRequest=e=>{this.client.events.emit("session_request",e)},this.onSessionProposal=e=>{this.client.events.emit("session_proposal",e)},this.onSessionDelete=e=>{this.client.events.emit("session_delete",e)},this.onProposalExpire=e=>{this.client.events.emit("proposal_expire",e)},this.onSessionRequestExpire=e=>{this.client.events.emit("session_request_expire",e)},this.onSessionRequestAuthenticate=e=>{this.client.events.emit("session_authenticate",e)},this.setEvent=(e,s)=>{switch(e){case"session_request":this.signClient.events[s]("session_request",this.onSessionRequest);break;case"session_proposal":this.signClient.events[s]("session_proposal",this.onSessionProposal);break;case"session_delete":this.signClient.events[s]("session_delete",this.onSessionDelete);break;case"proposal_expire":this.signClient.events[s]("proposal_expire",this.onProposalExpire);break;case"session_request_expire":this.signClient.events[s]("session_request_expire",this.onSessionRequestExpire);break;case"session_authenticate":this.signClient.events[s]("session_authenticate",this.onSessionRequestAuthenticate);break}},this.signClient={}}}const ne={decryptMessage:async n=>{const t={core:new m({storageOptions:n.storageOptions,storage:n.storage})};await t.core.crypto.init();const e=t.core.crypto.decode(n.topic,n.encryptedMessage);return t.core=null,e},getMetadata:async n=>{const t={core:new m({storageOptions:n.storageOptions,storage:n.storage}),sessionStore:null};t.sessionStore=new M(t.core,t.core.logger),await t.sessionStore.init();const e=t.sessionStore.get(n.topic),s=e?.peer.metadata;return t.core=null,t.sessionStore=null,s}},N=class extends R{constructor(n){super(n),this.events=new l.exports,this.on=(t,e)=>this.engine.on(t,e),this.once=(t,e)=>this.engine.once(t,e),this.off=(t,e)=>this.engine.off(t,e),this.removeListener=(t,e)=>this.engine.removeListener(t,e),this.pair=async t=>{try{return await this.engine.pair(t)}catch(e){throw this.logger.error(e.message),e}},this.approveSession=async t=>{try{return await this.engine.approveSession(t)}catch(e){throw this.logger.error(e.message),e}},this.rejectSession=async t=>{try{return await this.engine.rejectSession(t)}catch(e){throw this.logger.error(e.message),e}},this.updateSession=async t=>{try{return await this.engine.updateSession(t)}catch(e){throw this.logger.error(e.message),e}},this.extendSession=async t=>{try{return await this.engine.extendSession(t)}catch(e){throw this.logger.error(e.message),e}},this.respondSessionRequest=async t=>{try{return await this.engine.respondSessionRequest(t)}catch(e){throw this.logger.error(e.message),e}},this.disconnectSession=async t=>{try{return await this.engine.disconnectSession(t)}catch(e){throw this.logger.error(e.message),e}},this.emitSessionEvent=async t=>{try{return await this.engine.emitSessionEvent(t)}catch(e){throw this.logger.error(e.message),e}},this.getActiveSessions=()=>{try{return this.engine.getActiveSessions()}catch(t){throw this.logger.error(t.message),t}},this.getPendingSessionProposals=()=>{try{return this.engine.getPendingSessionProposals()}catch(t){throw this.logger.error(t.message),t}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(t){throw this.logger.error(t.message),t}},this.registerDeviceToken=t=>{try{return this.engine.registerDeviceToken(t)}catch(e){throw this.logger.error(e.message),e}},this.approveSessionAuthenticate=t=>{try{return this.engine.approveSessionAuthenticate(t)}catch(e){throw this.logger.error(e.message),e}},this.rejectSessionAuthenticate=t=>{try{return this.engine.rejectSessionAuthenticate(t)}catch(e){throw this.logger.error(e.message),e}},this.formatAuthMessage=t=>{try{return this.engine.formatAuthMessage(t)}catch(e){throw this.logger.error(e.message),e}},this.metadata=n.metadata,this.name=n.name||p,this.signConfig=n.signConfig,this.core=n.core,this.logger=this.core.logger,this.engine=new te(this)}static async init(n){const t=new N(n);return await t.initialize(),t}async initialize(){this.logger.trace("Initialized");try{await this.engine.init(),this.logger.info("WalletKit Initialization Success")}catch(n){throw this.logger.info("WalletKit Initialization Failure"),this.logger.error(n.message),n}}};let v=N;v.notifications=ne;const se=v;export{p as CLIENT_CONTEXT,$ as CLIENT_STORAGE_OPTIONS,X as CLIENT_STORAGE_PREFIX,R as IWalletKit,A as IWalletKitEngine,H as IWalletKitEvents,P as PROTOCOL,U as PROTOCOL_VERSION,G as REQUEST_CONTEXT,se as WalletKit,v as default};
//# sourceMappingURL=index.es.js.map
